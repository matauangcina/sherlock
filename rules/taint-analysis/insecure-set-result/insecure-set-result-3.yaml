rules:
  - id: insecure-set-result-3
    mode: taint
    options:
      taint_unify_mvars: true
    pattern-sources:
      - patterns:
        - pattern: |
            public void onActivityResult(..., ..., Intent $INTENT) {...}
        - pattern-inside: |
            public class $CLASSNAME extends $COMPONENT {...}
        - focus-metavariable: $INTENT
    pattern-sanitizers:
      - patterns:
        - pattern-either:
          - pattern:
              $INTENT.removeFlags(1);
          - pattern:
              $INTENT.removeFlags(2);
          - pattern:
              $INTENT.removeFlags(3);
        - pattern-inside: |
            public class $CLASSNAME extends $COMPONENT {...}
        - pattern-inside: |
            public void onActivityResult(...) {...}
    pattern-sinks:
      - patterns:
        - pattern: |
            setResult(..., $INTENT);
        - pattern-inside: |
            public class $CLASSNAME extends $COMPONENT {...}
        - pattern-inside: |
            public void onActivityResult(...) {...}
        - focus-metavariable: $INTENT
    message: $CLASSNAME
    languages:
      - java
    severity: WARNING