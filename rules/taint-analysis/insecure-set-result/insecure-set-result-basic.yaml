rules:
  - id: insecure-set-result-basic
    mode: taint
    pattern-sources:
      - patterns:
        - pattern: getIntent()
        - pattern-inside: public class $CLASSNAME extends $COMPONENT {...}
    pattern-sanitizers:
      - patterns:
        - pattern-either:
          - patterns: 
            - pattern: $INTENT.removeFlags($FLAG)
            - metavariable-regex:
                metavariable: $FLAG
                regex: (1|3|67|195)|(Intent\.FLAG_GRANT_(READ|WRITE|PREFIX|PERSISTABLE)_URI_PERMISSION\S?\|?)
          - patterns:
            - pattern: $INTENT.setFlags($FLAG)
            - metavariable-regex:
                metavariable: $FLAG
                regex: ^(?!(1|3|67|195)$|(Intent\.FLAG_GRANT_(READ|WRITE|PREFIX|PERSISTABLE)_URI_PERMISSION\S?\|?)$)$
          - pattern-inside: $INTENT.putExtra(...)
        - pattern-inside: public class $CLASSNAME extends $COMPONENT {...}
    pattern-sinks:
      - patterns:
        - pattern: setResult(..., $INTENT);
        - pattern-inside: public class $CLASSNAME extends $COMPONENT {...}
        - focus-metavariable: $INTENT
    message: $CLASSNAME
    languages:
      - java
    severity: WARNING