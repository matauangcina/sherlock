rules:
  - id: intent-redirection-implicit
    mode: taint
    pattern-sources:
      - patterns:
        - pattern-either:
          - pattern: $INTENT.getParcelableExtra($KEY)
          - pattern: $BUNDLE.getParcelable($KEY)
          - pattern: $BUNDLE.get($KEY)
        - pattern-either:
          - pattern-inside: $ACC onActivityResult(..., Intent $SRC) {...}
          - pattern-inside: ActivityResultLauncher<Intent> $LAUNCHER = registerForActivityResult(..., $SRC -> {...});
          - pattern-inside: $ACC $METHOD(ActivityResult $SRC) {...}
        - pattern-inside: public class $CLASSNAME extends $COMPONENT {...}
    pattern-sanitizers:
      - patterns:
        - pattern-either:
          - pattern: $INTENT.setClassName(..., ...)
          - pattern: $INTENT.setClass(..., ...)
          - patterns:
            - pattern-either:
              - pattern: $INTENT.setPackage($COMP)
              - pattern: $INTENT.setComponent($COMP)
              - pattern: $INTENT.setSelector($COMP)
            - metavariable-regex:
                metavariable: $COMP
                regex: ^(?!null).*$
          - patterns:
            - pattern: if ($COND) {...}
            - metavariable-regex:
                metavariable: $COND
                regex: ^.*\w+\.(getPackageName|getClassName)\(\)\.equals\(.+\)\s*&&\s*\w+\.(getPackageName|getClassName)\(\)\.equals\(.+\).*$
          - pattern-inside: $INTENT.putExtra(...)
        - pattern-inside: public class $CLASSNAME extends $COMPONENT {...}
    pattern-sinks:
      - patterns:
        - pattern-either:
          - pattern: startActivity($INTENT)
          - pattern: $CTX.startActivity($INTENT)
        - pattern-inside: public class $CLASSNAME extends $COMPONENT {...}
        - focus-metavariable: $INTENT
    message: $CLASSNAME
    languages:
      - java
    severity: WARNING