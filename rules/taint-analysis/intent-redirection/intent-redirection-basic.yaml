rules:
  - id: intent-redirection-basic
    mode: taint
    pattern-sources:
      - patterns:
        - pattern: getIntent()
        - pattern-either:
          - pattern: Intent $INTENT = getIntent();
          - pattern: getIntent().getParcelableExtra(...)
        - pattern-inside: public class $CLASSNAME extends $COMPONENT {...}
    pattern-sanitizers:
      - patterns:
        - pattern: if ($COND) {...}
        - pattern-inside: public class $CLASSNAME extends $COMPONENT {...}
        - metavariable-regex:
            metavariable: $COND
            regex: .*\w+\.getPackageName\(\)\.equals\(.+\)\s*\&\&\s*\w+\.getClassName\(\)\.equals\(.+\).*
    pattern-sinks:
      - patterns:
        - pattern: startActivity($INTENT);
        - pattern-inside: public class $CLASSNAME extends $COMPONENT {...}
        - focus-metavariable: $INTENT
    message: $CLASSNAME
    languages:
      - java
    severity: WARNING