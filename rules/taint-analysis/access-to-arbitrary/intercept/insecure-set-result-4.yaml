rules:
  - id: insecure-set-result-4
    mode: taint
    options:
      taint_unify_mvars: true
    pattern-sources:
      - patterns:
        - pattern: |
            $INTENT = $RESULT.getData();
        - pattern-inside: |
            public class $CLASSNAME extends $COMPONENT {...}
        - pattern-inside: |
            public void $METHOD(ActivityResult $RESULT) {...}
        - pattern: |
            $RESULT.getData()
    pattern-sanitizers:
      - patterns:
        - pattern-either:
          - pattern:
              $INTENT.removeFlags(1);
          - pattern:
              $INTENT.removeFlags(2);
          - pattern:
              $INTENT.removeFlags(3);
        - pattern: |
            public class $CLASSNAME extends $COMPONENT {...}
        - pattern-inside: |
            public void $METHOD(ActivityResult $RESULT) {...}
    pattern-sinks:
      - patterns:
        - pattern: |
            setResult(..., $INTENT);
        - pattern-inside: |
            public class $CLASSNAME extends $COMPONENT {...}
        - pattern-inside: |
            public void $METHOD(ActivityResult $RESULT) {...}
        - focus-metavariable: $INTENT   
    message: $CLASSNAME
    languages:
      - java
    severity: WARNING