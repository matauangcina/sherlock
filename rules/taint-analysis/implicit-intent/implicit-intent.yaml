rules:
  - id: implicit-intent
    mode: taint
    pattern-sources:
      - patterns:
        - pattern-either:
          - pattern: new Intent()
          - pattern: new Intent($ACTION)
          - pattern: new Intent("$ACTION")
          - pattern: new Intent("$ACTION", $URI)
        - pattern-inside: public class $CLASSNAME extends $COMPONENT {...}
    pattern-sanitizers:
      - patterns:
        - pattern-either:
          - pattern: $INTENT.setClassName($COMP, $COMP)
          - pattern: $INTENT.setPackage($COMP)
          - pattern: $INTENT.setClass($COMP, $COMP)
          - pattern: $INTENT.setComponent($COMP)
          - pattern: $INTENT.setSelector($COMP)
        - metavariable-regex:
            metavariable: $COMP
            regex: ^(?!null).*$
        - pattern-inside: public class $CLASSNAME extends $COMPONENT {...}
    pattern-sinks:
      - patterns:
        - pattern-either:
          - pattern: startActivity($INTENT)
          - pattern: $CTX.startActivity($INTENT)
          - pattern: sendBroadcast($INTENT)
          - pattern: sendOrderedBroadcast($INTENT, null, ...)
          - patterns: 
            - pattern: $CTX.sendBroadcast($INTENT)
            - metavariable-regex:
                metavariable: $CTX
                regex: ^(?!.*(L|l)ocal(B|b)roadcast.*$|.*(L|l)(B|b)(M|m).*$).*$
          - patterns: 
            - pattern: $CTX.sendOrderedBroadcast($INTENT, null, ...)
            - metavariable-regex:
                metavariable: $CTX
                regex: ^(?!.*(L|l)ocal(B|b)roadcast.*$|.*(L|l)(B|b)(M|m).*$).*$
        - pattern-inside: public class $CLASSNAME extends $COMPONENT {...}
        - focus-metavariable: $INTENT
    message: $CLASSNAME
    languages:
      - java
    severity: WARNING